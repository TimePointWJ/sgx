/*-------------所有可能加载的脚本--------------*/
require.config({
    paths: {
        "jquery": ["../assets/js/0-common/jquery.min"],
        "bootstrap": ["../assets/js/0-common/bootstrap"],
        "bootstrap-table": ["../assets/js/0-common/bootstrap-table"],
        "bootstrap-table-export": ["../assets/js/0-common/bootstrap-table-export"],
        "tableExport": ["../assets/js/0-common/tableExport"],
        "bootstrap-editable": ["../assets/js/0-common/bootstrap-editable"],
        "bootstrap-table-editable": ["../assets/js/0-common/bootstrap-table-editable"],
        "jquery.cookie": ["../assets/js/0-common/jquery.cookie"],
        "TileHeadPic": ["../assets/js/0-common/TileHeadPic"],
        "modernizr": ["../assets/js/0-common/modernizr"],
        "leaflet": ["../assets/js/0-common/leaflet"],
        "fileinput": ["../assets/js/0-common/fileinput.min"],
        "fileinput_locale_zh": ["../assets/js/0-common/fileinput_locale_zh"],
        'ueditor.config': ['../assets/UEditor-utf8-net/ueditor.config'],
        'ueditor': ['../assets/UEditor-utf8-net/ueditor.all.min'],
        "bootstrap-select": ["../assets/js/0-common/bootstrap-select.min"],
        "leaflet.contextmenu": ["../assets/Leaflet/plugins/Leaflet.contextmenu/leaflet.contextmenu"],
        "leaflet.MiniMap": ["../assets/Leaflet/plugins/Leaflet-MiniMap-master/Control.MiniMap"],
        "leaflet.Zoomslider": ["../assets/Leaflet/plugins/Leaflet.zoomslider-0.6.1/L.Control.Zoomslider"],
        "leaflet.fullscreen": ["../assets/Leaflet/plugins/Leaflet.fullscreen-gh-pages/Leaflet.fullscreen"],
        "leaflet.draw": ["../assets/Leaflet/plugins/Leaflet.draw-master/leaflet.draw-src"],
        "leaflet.measurecontrol": ["../assets/Leaflet/plugins/Leaflet.MeasureControl-gh-pages/leaflet.measurecontrol"],
        "leaflet.MarkerCluster": ["../assets/Leaflet/plugins/Leaflet.markercluster/leaflet.markercluster"],
        "leaflet.usermarker": ["../assets/Leaflet/plugins/Leaflet-usermarker-master/leaflet.usermarker"],
        "leaflet.defaultextent": ["../assets/Leaflet/plugins/Leaflet.defaultextent-master/leaflet.defaultextent"],
        "leaflet.echarts": ["../assets/Leaflet/plugins/Leaflet-echarts-master/leaflet-echarts"],
        "leaflet.echarts-source": ["../assets/Leaflet/plugins/Leaflet-echarts-master/echarts.source"],
        "mq-map": [" https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-map.js?key=lYrP4vF3Uk5zgTiGGuEzQGwGIVDGuy24"],
        "mq-routing": ["https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-routing.js?key=lYrP4vF3Uk5zgTiGGuEzQGwGIVDGuy24"],
        "leaflet-routing-machine": ["leaflet-routing-machine-master/dist/leaflet-routing-machine.min"],
        "control.geocoder": ["leaflet-routing-machine-master/examples/control.geocoder"],
        "leaflet.config": ["leaflet-routing-machine-master/examples/config"],
        "bootstrap-datetimepicker": ["../assets/js/0-common/bootstrap-datetimepicker.min"],
        "bootstrap-datetimepicker.zh-CN": ["../assets/js/0-common/bootstrap-datetimepicker.zh-CN"],
        "fullcalendar": ["../assets/js/0-common/fullcalendar.min"],
        "fullcalendar-zh-cn": ["../assets/js/0-common/fullcalendar-zh-cn"],
        "moment": ["../assets/js/0-common/moment.min"],
        "notifyme": ["../assets/js/0-common/notifyme"],
        "echarts": 'http://echarts.baidu.com/build/dist/echarts-all',
        "baguetteBox": ["../assets/js/0-common/baguetteBox"],
        "ztree": ["../assets/js/0-common/jquery.ztree.all.min"],
        "validationengine-en": ["../assets/js/fullcanlendar/formvalidator/js/jquery.validationengine-en"],
        "validationengine": ["../assets/js/fullcanlendar/formvalidator/js/jquery.validationengine"],
        "fullcalendar2": ["../assets/js/fullcanlendar/fullcal/fullcalendar"],
        "fullcalendar-custom": ["../assets/js/fullcanlendar/jquery-ui-1.8.6.custom.min"],
        "fullcalendar-timepicker-addon": ["../assets/js/fullcanlendar/jquery-ui-timepicker-addon"],
        "vue": ["../scripts/vue"],
    },
    shim: {//写清楚依赖，防止加载顺序错误
        jquery: {
            exports: 'jquery'
        },
        bootstrap: {
            deps: ['jquery']
        },
        "jquery.cookie": {
            deps: ['jquery']
        },
        TileHeadPic: {
            deps: ['jquery']
        },
        popmenu: {
            deps: ['jquery']
        },
        jquerygeo: {
            deps: ['jquery']
        },
        "bootstrap-table": {
            deps: ['bootstrap']
        },
        fileinput: {
            deps: ['bootstrap']
        },
        fileinput_locale_zh: {
            deps: ['fileinput']
        },
        "bootstrap-select": {
            deps: ['bootstrap']
        },
        'bootstrap-datetimepicker': {
            deps: ['bootstrap']
        },
        "bootstrap-datetimepicker.zh-CN": {
            deps: ['bootstrap-datetimepicker']
        },
        leaflet: {
            exports: 'leaflet'
        },
        "leaflet.contextmenu": {
            deps: ['leaflet']
        },
        "leaflet.MiniMap": {
            deps: ['leaflet']
        },
        "leaflet.Zoomslider": {
            deps: ['leaflet']
        },
        "leaflet.fullscreen": {
            deps: ['leaflet']
        },
        "leaflet.draw": {
            deps: ['leaflet']
        },
        "leaflet.measurecontrol": {
            deps: ['leaflet.draw']
        },
        "leaflet.MarkerCluster": {
            deps: ['leaflet']
        },
        "leaflet.MarkerClusterGroup": {
            deps: ['leaflet']
        },
        "leaflet.usermarker": {
            deps: ['leaflet']
        },
        "leaflet.defaultextent": {
            deps: ['leaflet']
        },
        "mq-map": {
            deps: ['leaflet']
        },
        "mq-routing": {
            deps: ['leaflet']
        },
        "leaflet-routing-machine": {
            deps: ['leaflet']
        },
        "control.geocoder": {
            deps: ['leaflet']
        },
        "leaflet.config": {
            deps: ['leaflet']
        },
        moment: {
            deps: ['jquery']
        },
        fullcalendar: {
            deps: ['moment']
        },
        "fullcalendar-zh-cn": {
            deps: ['fullcalendar']
        },
        "notifyme": {
            deps: ['jquery']
        },
        "leaflet.echarts": {
            deps: ['leaflet']
        },
        "leaflet.echarts-source": {
            deps: ['leaflet.echarts']
        },
        "ztree": {
            deps: ['jquery']
        },
        "validationengine-en": {
            deps: ['jquery']
        },
        "validationengine": {
            deps: ['fullcalendar2']
        },
        "fullcalendar2": {
            deps: ['jquery']
        },
        "fullcalendar-custom": {
            deps: ['jquery']
        },
        "fullcalendar-timepicker-addon": {
            deps: ['jquery']
        },
    }
})


/*---------------接口地址----------------*/
//脚本里用到的所有的转发连接都放在这里
var svcHeader = (window.location.protocol ? (window.location.protocol + "//")
		: "")
		+ window.location.host;
var SVC_SYS = svcHeader + "/MLDSService/System.svc";
var SVC_DYNC = svcHeader + "/MLDSService/Dynamic.svc";
var SVC_POP = svcHeader + "/MLDSService/Population.svc";
var SVC_PARTY = svcHeader + "/MLDSService/PartyService.svc";
var SVC_MAP = svcHeader + "/MLDSService/Map.svc";
var SVC_AGR = svcHeader + "/MLDSService/Agriculture.svc";
var SVC_BUS = svcHeader + "/MLDSService/Business.svc";
var SVC_NEW = svcHeader + "/MLDSNewService/Service.svc/GetData";
var SVC_DOWNLOAD = svcHeader + "/MLDSNewService/Service.svc/DownloadFile";
/*----------------集成方法---------------*/
function Download(file, callback) {
    console.log('Download', file, callback);
    $.get(SVC_DOWNLOAD, { downfile: file }, callback);
}
function Call(method, data, callback) {
    console.log('Call', method, data, JSON.stringify(data));
    $.ajax({
        type: "POST",
        url: SVC_NEW,
        contentType: "application/json",
        data: JSON.stringify({ data: JSON.stringify({ method: method, data: JSON.stringify(data) }) }),
        dataType: "JSON",
        processData: true,
        success: function(result) {
            var dataResult = result.GetDataResult;
            console.log(dataResult)
            return callback(JSON.parse(dataResult));
        }
    });
}

//获取url中的参数
function getUrlParam(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
    var r = window.location.search.substr(1).match(reg);  //匹配目标参数
    if (r != null) return unescape(r[2]); return null; //返回参数值
}
//注销
var logout = function () {
    $.cookie("JTZH_userID", null, { path: "/" });
    $.cookie("JTZH_districtID", null, { path: '/' })
    window.location.href = "../login.html";
}
function parseParam(param, key) {
    var paramStr = "";
    if (param instanceof String || param instanceof Number || param instanceof Boolean) {
        var val = encodeURIComponent(param);
        var keyval = key + "=" + val;
        paramStr += "&" + keyval;
    } else {
        $.each(param, function (i) {
            //if (this instanceof Window) return;
            var k = key == null ? i : key + (param instanceof Array ? "[" + i + "]" : "." + i);
            var keypaire = parseParam(this, k);
            (paramStr += '&' + keypaire);
        });
    }
    return paramStr.substr(1);
};
function GetRequest() {
    var url = location.search; //获取url中"?"符后的字串   
    var theRequest = new Object();
    if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
            var split = strs[i].split("=");
            var val = decodeURI(split[1]);
            val = val.indexOf('%') ? unescape(val) : val;
            theRequest[split[0]] = val;
        }
    }
    return theRequest;
}

function slashDate2yyyyMMdd(str) {
    "/Data(12345) => 2010-1-1"

    if (!str)return "";
    var d = eval('new ' + str.substr(1, str.length - 2));
 
    var ar_date = [d.getFullYear(), d.getMonth() + 1, d.getDate()];
    function dFormat(i) {
        return i < 10 ? "0" + i.toString() : i;
    }
    for (var i = 0; i < ar_date.length; i ++) ar_date[i] = dFormat(ar_date[i]);
    return ar_date.join('-')
}

/*----------------------------------加载公用模块-------------------------*/
//主页离开事件
function toPage(page) {
    window.scroll(0, 0);
    switch (page) {
        case "map": $("header").slideUp(1000, function () {
            window.location.href = "../1-map/map.html"
        });
            break;
        case "population": $("header").slideUp(1000, function () {
            window.location.href = "../2-population/population.html"
        });
            break;
        case "business": $("header").slideUp(1000, function () {
            window.location.href = "../3-business/business.html"
        });
            break;
        case "agriculture": $("header").slideUp(1000, function () {
            window.location.href = "../4-agriculture/agriculture.html"
        });
            break;
        case "dynamic": $("header").slideUp(1000, function () {
            window.location.href = "../5-dynamic/dynamic.html"
        });
            break;
        case "assistant": $("header").slideUp(1000, function () {
            window.location.href = "../6-assistant/assistant.html"
        });
            break;
        case "system": $("header").slideUp(1000, function () {
            window.location.href = "../7-system/system.html"
        });
            break;
        case "map_Z": $("header").slideUp(1000, function () {
            window.location.href = "../1-map/map_Z.html"
        });
            break;
        case "business_Z": $("header").slideUp(1000, function () {
            window.location.href = "../3-business/business_Z.html"
        });
            break;
        case "dynamic_Z": $("header").slideUp(1000, function () {
            window.location.href = "../5-dynamic/dynamic_Z.html"
        });
            break;
        case "travel_Z": $("header").slideUp(1000, function () {
            window.location.href = "../8-travel/travel_Z.html"
        });
            break;
        case "system_Z": $("header").slideUp(1000, function () {
            window.location.href = "../7-system/system_Z.html"
        });
            break;
        case "zuimeiYW": $("header").slideUp(1000, function () {
            window.location.href = "../8-travel/zuimeiyangwan.html"
        });
            break;
    }
}
//加载公共模块
var loadCommonModule = function (module) {
    $('title').html('魅力东山信息管理平台');
    $('#common_module-nav').html(
        '<nav class="navbar" style="margin-bottom:0;">' +
            '<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">' +
                '<div class="row">' +
                    '<div class="col-lg-2"><a class="navbar-brand logo" href="#"><img src="../assets/i/logo_.png" /></a><span class="logo_span"></span></div>' +
                    '<div class="col-lg-9">' +
                        '<ul class="menu">' +
                            '<li class="nav-menu AuMain002" id="common_module-nav-index"><a href="../0-index/index.html">首页</a></li>' +
                            '<li class="nav-menu-lock Aumap002" id="common_module-nav-map"><a href="../1-map/map.html">村务地图</a></li>' +
                            '<li class="nav-menu-lock Aupop001" id="common_module-nav-population"><a href="../2-population/population.html">人口管理</a></li>' +
                            '<li class="nav-menu-lock Aubus002" id="common_module-nav-business"><a href="../3-business/business.html">村务管理</a></li>' +
                            '<li class="nav-menu-lock Auagr001" id="common_module-nav-agriculture"><a href="../4-agriculture/agriculture.html">涉农管理</a></li>' +
                            '<li class="nav-menu-lock Auwel009" id="common_module-nav-welfare"><a href="../9-welfare/welfare.html">村民福利</a></li>' +
                            '<li class="nav-menu-lock Audync002" id="common_module-nav-dynamic"><a href="../5-dynamic/dynamic.html">动态社区</a></li>' +
                            '<li class="nav-menu-lock Auzuimeiyangwan"hidden="hidden" id="common_module-nav-zuimeiyangwan"><a href="../8-travel/zuimeiyangwan.html">微信管理</a></li>' +//<iframe src="building.html"></iframe>
                            '<li class="nav-menu-lock Auass001" id="common_module-nav-assistant"><a href="../6-assistant/assistant.html">个人助理</a></li>' +
                            '<li class="nav-menu-lock Ausys002" id="common_module-nav-system"><a href="../7-system/system.html">运维管理</a></li>' +
                        '</ul>' +
                    '</div>' +
                    '<div class="col-lg-1">' +
                        '<ul class="nav navbar-nav navbar-right menu-right">' +
                            '<li><button class="btn btn-block btn-default"  id="account-info">用户</button></li>' +
                        '</ul>' +
                    '</div>' +
                '</div>' +
            '</div>' +
        '</nav>');
    $('body').append(
     '<div class="modal fade" id="account-info-modal">' +
        '<div class="modal-dialog">' +
            '<div class="modal-content">' +
                '<div class="modal-header">' +
                    '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +
                    '<h4 class="modal-title">当前用户</h4>' +
                '</div>' +
                '<div class="modal-body">' +
                    '<div class="row">' +
                        '<div class="col-md-5">' +
                            '<div class="thumbnail">' +
                                '<img src="../Upload/portrait/R0001.jpg" />' +
                            '</div>' +
                        '</div>' +
                        '<div class="col-md-7">' +
                            '<ul class="list-group">' +
                                '<li class="list-group-item"><span class="list-group-item-title">姓名：</span><span class="list-group-item-name">超级管理员</span></li>' +
                                '<li class="list-group-item"><span class="list-group-item-title">职位：</span><span class="list-group-item-role">超级管理员</span></li>' +
                                '<li class="list-group-item"><span class="list-group-item-title">街道：</span>东山镇</span></li>' +
                                '<li class="list-group-item"><span class="list-group-item-title">社区：</span><span class="list-group-item-district">潦里村</span></li>' +
                                '<li class="list-group-item"><span class="list-group-item-title">最后登录时间：</span><span class="list-group-item-lastTime">2016年6月23日20:38:36</span></li>' +
                            '</ul>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="modal-footer">' +
                    '<button type="button" onclick="logout()" class="btn btn-primary" style="float:left">注销</button>' +
                    '<a class="btn btn-default"href="../6-assistant/ASS_PersonInform.html">修改个人信息>></a>' +
                '</div>' +
            '</div>' +
        '</div>' +
    '</div>')
    $('body').append(
     '<div class="modal fade" id="common-alert">' +
        '<div class="modal-dialog">' +
            '<div class="modal-content">' +
                '<div class="modal-header">' +

                    '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +

                '</div>' +
                '<div class="modal-body"style="text-align:center"></div>' +
                '<div class="modal-footer"style="text-align:center">' +
                    '<button type="button" class="btn btn-primary confirm" data-dismiss="modal">确定</button>' +
                    '<button type="button" class="btn btn-default cancel"  data-dismiss="modal">取消</button>' +
                '</div>' +
            '</div>' +
        '</div>' +
    '</div>')
    $('#common_module-nav-' + module).addClass("nav-current");
    $('#account-info').click(function () {
        $('#account-info-modal').modal()
    })
}
var loadCommonModule_Z = function (module) {
    $('title').html('魅力东山信息管理平台');
    $('#common_module-nav').html(
        '<nav class="navbar" style="margin-bottom:0;">' +
            '<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">' +
                '<div class="row">' +
                    '<div class="col-lg-1"><a class="navbar-brand logo" href="#"><img src="../assets/i/logo.png" /></a></div>' +
                    '<div class="col-lg-10">' +
                        '<ul class="menu">' +
                            '<li class="nav-menu AuMain001" id="common_module-nav-index_Z"><a href="../0-index/index_Z.html">首页</a></li>' +
                            '<li class="nav-menu-lock Aumap001" id="common_module-nav-map_Z"><a href="../1-map/map_Z.html" >地理信息</a></li>' +
                            '<li class="nav-menu-lock Aubus001" id="common_module-nav-business_Z"><a href="../3-business/business_Z.html" >政务管理</a></li>' +
                            '<li class="nav-menu-lock Audync001" id="common_module-nav-dynamic_Z"><a href="../5-dynamic/dynamic_Z.html" >社会管理</a></li>' +
                            '<li class="nav-menu-lock Autrvl001" id="common_module-nav-travel_Z"><a href="../8-travel/travel_Z.html" >文旅信息</a></li>' +
                            '<li class="nav-menu-lock Ausys001" id="common_module-nav-system_Z"><a href="../7-system/system_Z.html" >运维管理</a></li>' +
                        '</ul>' +
                    '</div>' +
                    '<div class="col-lg-1">' +
                        '<ul class="nav navbar-nav navbar-right menu-right">' +
                            '<li><button class="btn btn-block btn-default"  id="account-info">用户</button></li>' +
                        '</ul>' +
                    '</div>' +
                '</div>' +
            '</div>' +
        '</nav>');
    $('body').append(
     '<div class="modal fade" id="account-info-modal">' +
        '<div class="modal-dialog">' +
            '<div class="modal-content">' +
                '<div class="modal-header">' +
                    '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +
                    '<h4 class="modal-title">当前用户</h4>' +
                '</div>' +
                '<div class="modal-body">' +
                    '<div class="row">' +
                        '<div class="col-md-5">' +
                            '<div class="thumbnail">' +
                                '<img src="../Upload/portrait/R0001.jpg" />' +
                            '</div>' +
                        '</div>' +
                        '<div class="col-md-7">' +
                            '<ul class="list-group">' +
                                '<li class="list-group-item"><span class="list-group-item-title">登录名：</span><span class="list-group-item-userName">admin</span></li>' +
                                '<li class="list-group-item"><span class="list-group-item-title">姓名：</span><span class="list-group-item-name">超级管理员</span></li>' +
                                '<li class="list-group-item"><span class="list-group-item-title">职位：</span><span class="list-group-item-role">超级管理员</span></li>' +
                                '<li class="list-group-item"><span class="list-group-item-title">区域：</span><span class="list-group-item-district">东山镇</span></li>' +
                                '<li class="list-group-item"><span class="list-group-item-title">最后登录时间：</span><span class="list-group-item-lastTime">2016年6月23日20:38:36</span></li>' +
                            '</ul>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="modal-footer">' +
                    '<button type="button" onclick="logout()" class="btn btn-primary" style="float:left">注销</button>' +
                    '<a class="btn btn-default"href="../6-assistant/ASS_PersonInform_Z.html">修改个人信息>></a>' +
                '</div>' +
            '</div>' +
        '</div>' +
    '</div>')
    $('body').append(
    '<div class="modal fade" id="common-alert">' +
        '<div class="modal-dialog">' +
            '<div class="modal-content">' +
                '<div class="modal-header" >' +
                    '<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +
                    '<h5 class="modal-title" ></h5>' +
                '</div>' +
                '<div class="modal-body"style="text-align:center"></div>' +
                '<div class="modal-footer"style="text-align:center">' +
                    '<button type="button" class="btn btn-primary confirm"  data-dismiss="modal">确定</button>' +
                    '<button type="button" class="btn btn-default cancel" data-dismiss="modal">取消</button>' +
                '</div>' +
            '</div>' +
        '</div>' +
    '</div>')

    $('#common_module-nav-' + module).addClass("nav-current");
    $('#account-info').click(function () {
        $('#account-info-modal').modal()
    })
}

//登陆状态检测
var accountCheck = function (authorityID) {
    //if (authorityID==1) {
    //    $('#common_module-nav-zuimeiyangwan').remove();
    //}
    $.ajax({
        url: SVC_SYS + "/accountCheck",
        data: {
            userID: $.cookie("JTZH_userID"),
            authorityID: authorityID,
            districtID: $.cookie("JTZH_districtID")
        },
        success: function (data) {
            //检测登录信息
            if (data.success == true) {
                document.title = data.data.district;
                if (data.data.district == '莫厘') {
                    $('#common_module-nav-zuimeiyangwan').remove();
                    $('.logo_span').html('山水莫厘');
                    $('.main-header').css("backgroundImage", "url(../assets/i/index/moli.jpg)");
                }
                if (data.data.district == '三山') {
                    $('#common_module-nav-zuimeiyangwan').remove();
                    $('.logo_span').html('三山岛');

                    // 在三山岛下的家庭人口合并到基础人口
                    $('[href="POP_Family.html"]').attr("disabled","disabled");
                }
                if (data.data.district == '渡口') {
                    $('#common_module-nav-zuimeiyangwan').remove();
                    $('.logo_span').html('钟灵渡口');
                    if (authorityID == '1') {
                        $('.main-header').css("backgroundImage", "url(../assets/i/dqbanner.png)");
                    }
                }
                if (data.data.district == '杨湾') {
                    $('.main-header').css("backgroundImage", "url(../assets/i/index/bg.png)");

                    $('.logo_span').html('醉美杨湾');
                }
                if (data.data.district == '东山') {
                    $('.main-header').css("backgroundImage", "url(../assets/i/index/bg.png)");
                    //document.getElementById('main-header').style.backgroundImage = "url(../assets/i/index/bg.png)";
                }
                if (data.data.district == '渡桥') {
                    $('.main-header').css("backgroundImage", "url(../assets/i/index/bg.png)");
                    //document.getElementById('main-header').style.backgroundImage = "url(../assets/i/index/bg.png)";
                    //  $('#common_module-nav-zuimeiyangwan').remove();
                    $('.logo_span').html('美丽渡桥');

                }
                if (data.data.district == '潦里') {
                    $('.main-header').css("backgroundImage", "url(../assets/i/index/bg.png)");
                    // document.getElementById('main-header').style.backgroundImage = "url(../assets/i/index/bg.png)";
                    $('#common_module-nav-zuimeiyangwan').remove();
                    $('.logo_span').html('物华潦里');
                }
                if ($.cookie("JTZH_userID") == 'LLC0001' || $.cookie("JTZH_userID") == 'DSC0001') {
                    $('#table-add').remove();
                    $('#table-remove').remove();
                    $('.check').remove();
                    $('.edit').remove();
                    $('.remove').remove();
                }

                $('.list-group-item-userName').html(data.data.userName);
                $('.list-group-item-name').html(data.data.name);
                $('.list-group-item-role').html(data.data.role);
                $('.list-group-item-district').html(data.data.district);
                $('.list-group-item-lastTime').html(data.data.lastTime);
            } else {
                $('#common-alert').find('.modal-title').html('');
                $('#common-alert').find('.modal-title').html('警告');
                $('#common-alert').find('.modal-body').html('');
                $('#common-alert').find('.modal-body').html('登录信息已过期！1秒后将跳回登录界面。。。');
                $('#common-alert').modal();
                setTimeout(function () {
                    window.location.href = "../login.html"
                }, 1000)
            }
            //控制当前权限
            //console.log(data.data);
            if (data.data.isControl != true) {
                if (authorityID != 'Main') {
                    //弹出
                    console.log('当前用户无权限访问该模块，等待1s后跳回登录！');

                }
            }
            //控制菜单
            // console.log(data.data.authority);
            for (var i in data.data.authority) {
                //父模块
                // console.log(data.data.authority[i].moduleName + '-' + data.data.authority[i].authorityID + '-' + data.data.authority[i].isControl + '-' + data.data.authority[i].authorityID + ';');
                if (data.data.authority[i].isControl == true) {
                    //show
                    $('.Au' + data.data.authority[i].authorityID).removeClass('nav-menu-lock').addClass('nav-menu');
                    for (var j in data.data.authority[i].subAuthority) {
                        //子模块
                        if (data.data.authority[i].subAuthority[j].isControl == true) {
                            //  console.log(data.data.authority[i].subAuthority[j].authorityName + '-' + data.data.authority[i].subAuthority[j].isControl + ';');
                            $('.Sub' + data.data.authority[i].subAuthority[j].authorityID).removeClass('sub_menu-lock')
                        } else {
                            $('.Sub' + data.data.authority[i].subAuthority[j].authorityID).remove();
                        }
                    }
                } else {
                    //remove
                    $('.Au' + data.data.authority[i].authorityID).remove();
                }

            }
        },
        error: function () {
            $('#common-alert').find('.modal-title').html('');
            $('#common-alert').find('.modal-title').html('警告');
            $('#common-alert').find('.modal-body').html('');
            $('#common-alert').find('.modal-body').html('登录信息已过期！1秒后将跳回登录界面。。。');
            $('#common-alert').modal();
            setTimeout(function () {
                //window.location.href = "../login.html"
            }, 1000)

        }
    })
}
//控制台登陆状态检测
var ctrlAccountCheck = function () {
    $.ajax({
        url: svc_sys + "/ctrlAccountCheck",
        data: {
            userID: $.cookie("JTZH_admin")
        },
        success: function (data) {
            var json = eval('(' + data + ')');
            if (json.Code != 1 && json.Code != "1") {
                $('.am-modal-hd').html('');
                $('.am-modal-hd').html('警告<a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>');
                $('.am-modal-bd').html('');
                $('.am-modal-bd').html('登录信息已过期！2秒后将跳回登录界面。。。');
                $('#modal-alert').modal();
                setTimeout(function () {
                    window.location.href = "../ctrllogin.html"
                }, 2000)
            } else {
                $('.informaton-user-img').html('<img src="' + json.Result.portrait + '" />');
                $('.informaton-user-name').html(json.Result.name);
                $('.list-group-item-district').html(data.data.district);
                $('.informaton-user-role').html(json.Result.role);
                $('.informaton-user-last_time').html("<br />" + json.Result.lastTime);
            }
        },
        error: function () {
            $('.am-modal-hd').html('');
            $('.am-modal-hd').html('警告<a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>');
            $('.am-modal-bd').html('');
            $('.am-modal-bd').html('登录信息已过期！2秒后将跳回登录界面。。。');
            $('#modal-alert').modal();
            setTimeout(function () {
                window.location.href = "../ctrllogin.html"
            }, 2000)

        }
    })
}


var clearPopup = function () {
    $(".add-popup").html('');
}

/*-----------------------------------部分插件功能-------------------------------------*/
//获取table高度
function getHeight() {
    return $(window).height() - $('h1').innerHeight(true) - $('#container').innerHeight(true);
}

//人民币大小写转换
var c = "零壹贰叁肆伍陆柒捌玖".split("");
// ["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"]
var _c = {}; // 反向对应关系
for (var i = 0; i < c.length; i++) {
    _c[c[i]] = i;
};

var d = "元***万***亿***万";
var e = ",拾,佰,仟".split(",");
function unit4(arr) {
    var str = "", i = 0;
    while (arr.length) {
        var t = arr.pop();
        str = (c[t] + (t == 0 ? "" : e[i])) + str;
        i++;
    }

    str = str.replace(/[零]{2,}/g, "零");

    str = str.replace(/^[零]/, "");
    str = str.replace(/[零]$/, "");
    if (str.indexOf("零") == 0) {
        str = str.substring(1);
    }
    if (str.lastIndexOf("零") == str.length - 1) {
        str = str.substring(0, str.length - 1);
    }

    return str;
}
function _formatD(a) {
    // 转化整数部分
    var arr = a.split(""), i = 0, result = "";
    while (arr.length) {
        var arr1 = arr.splice(-4, 4);

        var dw = d.charAt(i), unit = unit4(arr1);

        if (dw == '万' && !unit) {
            dw = "";
        }
        result = unit + dw + result;
        i += 4;
    }
    return result == "元" ? "" : result;
}
function _formatF(b) {
    // 转化小数部分
    b = b || "";
    switch (b.length) {
        case 0:
            return "整";
        case 1:
            return c[b] + "角";
        default:
            return c[b.charAt(0)] + "角" + c[b.charAt(1)] + "分";
    }
}
function _format(n) {
    var a = ("" + n).split("."), a0 = a[0], a1 = a[1];
    return _formatD(a0) + _formatF(a1);
}

function parse4(u4) {
    var res = 0;
    while (t = /([零壹贰叁肆伍陆柒捌玖])([拾佰仟]?)/g.exec(u4)) {
        var n = _c[t[1]], d = {
            "": 1,
            "拾": 10,
            "佰": 100,
            "仟": 1000
        }[t[2]];
        res += n * d;
        u4 = u4.replace(t[0], "");
    }
    var result = ("0000" + res);
    return result.substring(result.length - 4);
}
function _parseD(d) {
    var arr = d.replace(/[零]/g, "").split(/[万亿]/), rs = "";
    for (var i = 0; i < arr.length; i++) {
        rs += parse4(arr[i]);
    }
    ;
    return rs.replace(/^[0]+/, "");
};
function _parseF(f) {
    var res = "", t = f.replace(/[^零壹贰叁肆伍陆柒捌玖]+/g, "").split(""); // 去掉单位
    if (t.length) {
        res = ".";
    } else {
        return "";
    }
    ;
    for (var i = 0; (i < t.length && i < 2) ; i++) {
        res += _c[t[i]];
    }
    ;
    return res;
};
function _parse(rmb) {
    var a = rmb.split("元"), a1 = a[1], a0 = a[0];
    if (a.length == 1) {
        a1 = a0;
        a0 = "";
    }
    return _parseD(a0) + _parseF(a1);

};
//小写转大写
function formatRMB(num) {
    var n = Number(num);
    if (!isNaN(num)) {
        if (num == 0) {
            return "零元整";
        } else {
            return _format(n);
        }
    } else {
        return false;
    }
}
//大写转小写
function parseRMB(rmb) {
    if (/^[零壹贰叁肆伍陆柒捌玖元万亿拾佰仟角分整]{2,}$/.test(rmb)) {
        var result = _parse(rmb);
        return rmb == this.formatRMB(result) ? result : result + "(?)";
    } else {
        return false;
    }
};
//生成随机颜色
function getRandomColor() {
    var c = '#';
    var cArray = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'];
    for (var i = 0; i < 6; i++) {
        var cIndex = Math.round(Math.random() * 15);
        c += cArray[cIndex];
    }
    return c;
}

/*----------------------------------地图配置信息--------------------------------------*/

//初始化
var CONST_MAPINIT = {
    center: [31.1967, 120.56652],
    zoom: 7,
    fullExtent: [[31.18922, 120.58178], [31.20601, 120.56527]]
};
//矢量
var CONST_SZMAP = {
    //2012年地图
    //url: 'http://mt{s}.szgis.cn/v2/gettile/?level={z}&row={y}&col={x}&maptype=map&imgtype=png',
    //2015年地图
    url: 'http://arcgis1.szgis.cn/arcgis/rest/services/SZ_MAP_20150902/MapServer/tile/{z}/{y}/{x}',
    options: {
        attribution: "苏州地图  审图号：苏S（2015）003号",
        errorTileUrl: "",
        maxZoom: 11,
        minZoom: 2,
        opacity: 1,
        subdomains: [1, 2, 3, 4],
        tileSize: 256,
        unloadInvisibleTiles: false,
        updateWhenIdle: false,
        zoomOffset: 0
    }
};
//影像
var CONST_SZSATELLITE = {
    //2012年地图
    //url: "http://mt{s}.szgis.cn/v2/gettile/?level={z}&row={y}&col={x}&maptype=satellite&imgtype=jpg",
    //2015年地图
    url: 'http://arcgis1.szgis.cn/arcgis/rest/services/SZ_SATELLITE_20150902/MapServer/tile/{z}/{y}/{x}',
    options: {
        attribution: "苏州影像  审图号：苏S（2015）003号",
        errorTileUrl: "",
        maxZoom: 11,
        minZoom: 2,
        opacity: 1,
        subdomains: [1, 2, 3, 4],
        tileSize: 256,
        unloadInvisibleTiles: false,
        updateWhenIdle: false,
        zoomOffset: 0
    }
};
//道路
var CONST_SZROAD = {
    //2012年地图
    //url: "http://mt{s}.szgis.cn/v2/gettile/?level={z}&row={y}&col={x}&maptype=road&imgtype=png",
    //2015年地图
    url: 'http://arcgis1.szgis.cn/arcgis/rest/services/SZ_ROAD_20151209/MapServer/tile/{z}/{y}/{x}',
    options: {
        attribution: "",
        errorTileUrl: "",
        maxZoom: 11,
        minZoom: 2,
        opacity: 1,
        subdomains: [1, 2, 3, 4],
        tileSize: 256,
        unloadInvisibleTiles: false,
        updateWhenIdle: false,
        zoomOffset: 0
    }
};
//兴趣点
var CONST_SZPOI = {
    //2012年地图
    //url: "http://mt{s}.szgis.cn/v2/gettile/?level={z}&row={y}&col={x}&maptype=poi&imgtype=png",
    //2015年地图
    url: 'http://arcgis1.szgis.cn/arcgis/rest/services/SZ_POI_20151209/MapServer/tile/{z}/{y}/{x}',
    options: {
        attribution: "",
        errorTileUrl: "",
        maxZoom: 11,
        minZoom: 2,
        opacity: 1,
        subdomains: [1, 2, 3, 4],
        tileSize: 256,
        unloadInvisibleTiles: false,
        updateWhenIdle: false,
        zoomOffset: 0
    }
};
//交通
var CONST_SZCOMMUNITY = {
    url: "http://mt{s}.szgis.cn/v2/gettile/?level={z}&row={y}&col={x}&maptype=community&imgtype=png",
    options: {
        attribution: "",
        errorTileUrl: "",
        maxZoom: 11,
        minZoom: 2,
        opacity: 1,
        subdomains: [1, 2, 3, 4],
        tileSize: 256,
        unloadInvisibleTiles: false,
        updateWhenIdle: false,
        zoomOffset: 0
    }
};


/*----------地图API--初步整理------------*/
function mapCRS() {
    function transformMap(initOptions) {
        var This = this;

        this.map = null;
        this.load = function (container, options) {
            This.map = L.map(container, options);
        }
        this.initLayer = function (baseLayers, overlays) {
            if (!This.map) {
                new Error("未初始化地图对象");
            }
            for (var p in baseLayers) {
                baseLayers[p] = This.getTileLayer(baseLayers[p].url, baseLayers[p].options);
            }
            for (var p in overlays) {
                overlays[p] = This.getTileLayer(overlays[p].url, overlays[p].options);
            }
            L.control.layers(baseLayers, overlays).addTo(This.map);
        }
        this.getTileLayer = function (url, options) {
            return L.tileLayer(url, options);
        }

        this.panTo = function (latlng, options) {
            This.map.panTo(latlng, options);
        }
        this.setZoom = function (zoom, options) {
            This.map.setZoom(delta, options);
        }
        this.zoomIn = function (delta, options) {
            This.map.zoomIn(delta, options);
        }
        this.zoomOut = function (delta, options) {
            This.map.zoomOut(delta, options);
        }
        this.fullExent = function (bounds) {
            This.map.fitBounds(bounds);
        }
        this.fitBounds = function (xmin, ymin, xmax, ymax) {
            This.map.fitBounds([[xmin, ymin], [xmax, ymax]]);
        }
        this.remove = function () {
            This.map.remove();
            This.map = null;
        }
        this.clearOverlay = function () {
            //清空地图
            This.map.eachLayer(function (layer) {
                if (!layer._url) This.map.removeLayer(layer);
            }, This.map);
        }
    }
    L.Projection.Suzhou = {
        project: function (t) {
            var x = 6378245;
            var v = 0.00335232986925914;
            var D = 120.583333;
            var i = -3421129;
            var s = 50805;
            var o = -75.812;
            var n = -10.233;
            var B = Math.PI / 180;
            var E = t.lat * B;
            var y = t.lng * B;
            var z = D * B;
            var p = 2 * v - v * v;
            var m = p / (1 - p);
            var k = Math.tan(E) * Math.tan(E);
            var w = Math.pow(m, 2) * Math.pow(Math.cos(E), 2);
            var G = (y - z) * Math.cos(E);
            var h = (1 - p / 4 - 3 * Math.pow(p, 2) / 64 - 5 * Math.pow(p, 3) / 256) * E;
            var g = (3 * p / 8 + 3 * Math.pow(p, 2) / 32 + 45 * Math.pow(p, 3) / 1024) * Math.sin(2 * E);
            var f = (15 * Math.pow(p, 2) / 256 + 45 * Math.pow(p, 3) / 1024) * Math.sin(4 * E);
            var d = (35 * Math.pow(p, 3) / 3072) * Math.sin(6 * E);
            var r = x * (h - g + f - d);
            var q = x / Math.sqrt(1 - p * Math.pow(Math.sin(E), 2));
            var e = r + q * Math.tan(E) * (Math.pow(G, 2) / 2 + (5 - k + 9 * w + 4 * Math.pow(w, 2)) * Math.pow(G, 4) / 24) + (61 - 58 * k + Math.pow(k, 2) + 270 * w - 330 * k * w) * Math.pow(G, 6) / 720;
            var c = q * (G + (1 - k + w) * Math.pow(G, 3) / 6 + (5 - 18 * k + Math.pow(k, 2) + 14 * w - 58 * k * w) * Math.pow(G, 5) / 120);
            var u = e + i + n;
            var j = c + s + o;
            return new L.Point(j, u)
        },
        unproject: function (C) {
            var B = 6378245;
            var w = 0.00335232986925914;
            var I = 120.583333;
            var c = -3421129;
            var s = 50805;
            var m = -75.812;
            var h = -10.233;
            var v = C.x;
            var u = C.y;
            var q;
            var t;
            var K, J, e, p, E;
            var o, l, g, f;
            var r, H, G, D;
            q = (180 / Math.PI) * 3600;
            v -= s;
            u -= c;
            v -= m;
            u -= h;
            K = u * q / 6367558.4969;
            J = (K * Math.PI / 180) / 3600;
            H = Math.cos(J) * Math.cos(J);
            e = K + (50221746 + (293622 + (2350 + 22 * H) * H) * H) * Math.sin(J) * Math.cos(J) * q * (1e-10);
            p = (e * Math.PI / 180) / 3600;
            G = Math.cos(p) * Math.cos(p);
            r = 6399698.902 - (21562.267 - (108.973 - 0.612 * G) * G) * G;
            o = (0.5 + 0.003369 * G) * Math.sin(p) * Math.cos(p);
            l = 0.333333 - (0.166667 - 0.001123 * G) * G;
            g = 0.25 + (0.16161 + 0.00562 * G) * G;
            f = 0.2 - (0.1667 - 0.0088 * G) * G;
            t = (v / r) / Math.cos(p);
            D = t * t;
            var n = e - (1 - (g - 0.12 * D) * D) * D * o * q;
            n = n / 3600;
            E = (1 - (l - f * D) * D) * t * q;
            var d = (E / 3600) + I;
            return new L.LatLng(n, d)
        }
    };

    L.CRS.EPSG320500 = L.extend({}, L.CRS, {
        code: "EPSG320500",
        projection: L.Projection.Suzhou,
        originX: -20000,
        originY: 130000,
        minX: -20000,
        minY: -20000,
        maxX: 130000,
        maxY: 130000,
        tileSize: 256,
        latLngToPoint: function (f, d) {
            var c = this.projection.project(f);
            c = this.checkProjectedPoint(c);
            var b = this.getSize(d);
            var a = b.x * ((c.x - this.originX) / (this.maxX - this.minX));
            var e = b.y * ((this.originY - c.y) / (this.maxY - this.minY));
            return new L.Point(a, e)
        },
        pointToLatLng: function (a, e) {
            var f = parseFloat(this.scale(e));
            var d = (a.x * (this.maxX - this.minX)) / f + this.originX;
            var b = this.originY - (a.y * (this.maxY - this.minY)) / f;
            var c = new L.Point(d, b);
            c = this.checkProjectedPoint(c);
            return this.projection.unproject(c)
        },
        scale: function (a) {
            return this.tileSize * Math.pow(2, a)
        },
        getSize: function (b) {
            var a = this.scale(b);
            return L.point(a, a)
        },
        checkProjectedPoint: function (b) {
            var a = b.x;
            var c = b.y;
            while (a < this.minX) {
                a += (this.maxX - this.minX)
            }
            while (a > this.maxX) {
                a -= (this.maxX - this.minX)
            }
            while (c < this.minY) {
                c += (this.maxY - this.minY)
            }
            while (c > this.maxY) {
                c -= (this.maxY - this.minY)
            }
            return L.point(a, c)
        }
    });

    L.CRS.EPSG320501 = L.extend({}, L.CRS, {
        code: "EPSG320501",
        projection: L.Projection.Suzhou3D,
        originX: -500000,
        originY: 500000,
        minX: -500000,
        minY: -500000,
        maxX: 500000,
        maxY: 500000,
        tileSize: 256,
        latLngToPoint: function (f, d) {
            var c = this.projection.project(f);
            c = this.checkProjectedPoint(c);
            var b = this.getSize(d);
            var a = b.x * ((c.x - this.originX) / (this.maxX - this.minX));
            var e = b.y * ((this.originY - c.y) / (this.maxY - this.minY));
            return new L.Point(a, e)
        },
        pointToLatLng: function (a, e) {
            var f = this.scale(e);
            var d = this.originX + (a.x / f) * (this.maxX - this.minX);
            var b = this.originY - (a.y / f) * (this.maxY - this.minY);
            var c = new L.Point(d, b);
            c = this.checkProjectedPoint(c);
            return this.projection.unproject(c)
        },
        scale: function (a) {
            return this.tileSize * Math.pow(2, a)
        },
        getSize: function (b) {
            var a = this.scale(b);
            return L.point(a, a)
        },
        checkProjectedPoint: function (b) {
            var a = b.x;
            var c = b.y;
            while (a < this.minX) {
                a += (this.maxX - this.minX)
            }
            while (a > this.maxX) {
                a -= (this.maxX - this.minX)
            }
            while (c < this.minY) {
                c += (this.maxY - this.minY)
            }
            while (c > this.maxY) {
                c -= (this.maxY - this.minY)
            }
            return L.point(a, c)
        }
    });
}
function mapInit(map, zoomLevel) {
    //获取切片数据的URL，x,y是切片的坐标，z是缩放级别
    var osmUrl = CONST_SZSATELLITE.url,
        osm = L.tileLayer(osmUrl, {
            attribution: "苏州地图  审图号：苏S（2015）003号",
            errorTileUrl: "",
            maxZoom: 12,
            minZoom: 2,
            opacity: 1,
            subdomains: [1, 2, 3, 4],
            tileSize: 256,
            unloadInvisibleTiles: false,
            updateWhenIdle: false,
            zoomOffset: 0
        });

    $.ajax({
        url: SVC_MAP + "/getDistrictCenter",
        type: "GET",
        data: {
            districtID: $.cookie('JTZH_districtID')
        },
        success: function (data) {
            //console.log(data);
            var latlng = new L.LatLng(data.x, data.y);
            map.setView(latlng, zoomLevel);

        }, error: function () {
            var latlng = new L.LatLng(31.0848565751, 120.4066879619);
            map.setView(latlng, zoomLevel);
        }
    })
    map.addLayer(osm);
    L.control.scale({
        imperial: false
    }).addTo(map);
    var miniMap = new L.Control.MiniMap(L.tileLayer(CONST_SZMAP.url, CONST_SZMAP.options), {
        width: 200,
        height: 200,
        toggleDisplay: true
    }).addTo(map);
    miniMap._toggleDisplayButtonClicked();
    var baseLayers = {
        "矢量地图": CONST_SZMAP,
        "影像地图": CONST_SZSATELLITE
    };
    var overlays = {
        "路网": CONST_SZROAD,
        "标注": CONST_SZPOI,
        "社区图": CONST_SZCOMMUNITY
    };
    for (var p in baseLayers) {
        baseLayers[p] = L.tileLayer(baseLayers[p].url, baseLayers[p].options);
    }
    for (var p in overlays) {
        overlays[p] = L.tileLayer(overlays[p].url, overlays[p].options);
    }
    L.control.layers(baseLayers, overlays, {
        position: 'bottomleft'
    }).addTo(map);

}
function locateExtent(pointList) {
    if (pointList && pointList.length > 0) {
        var xmin = 0, ymin = 0, xmax = 0, ymax = 0;
        for (var i = 0; i < pointList.length; i++) {
            if (i == 0) {
                xmin = pointList[i].lng;
                ymin = pointList[i].lat;
                xmax = pointList[i].lng;
                ymax = pointList[i].lat;
            }
            else {
                if (xmin > pointList[i].lng) {
                    xmin = pointList[i].lng
                }
                if (ymin > pointList[i].lat) {
                    ymin = pointList[i].lat;
                } if (xmax < pointList[i].lng) {
                    xmax = pointList[i].lng;
                }
                if (ymax < pointList[i].lat) {
                    ymax = pointList[i].lat;
                }
            }
        }

        map.fitBounds([[ymin, xmin], [ymax, xmax]]);
    }
}
//清空
function cleanLayer(map) {
    map.eachLayer(function (layer) {
        if (!layer._url) map.removeLayer(layer);
    }, map);
}

//显示农田
function findFarmLand(latlng, farmLandID, map) {
    $.ajax({
        url: SVC_MAP + "/mapFindFarmLand",
        type: "GET",
        data: {
            farmLandID: farmLandID
        },
        success: function (data) {
            console.log(data);
            map.eachLayer(function (layer) {
                if (!layer._url && layer.options && layer.options.color == "#009933" && layer._latlngs.length != 0) map.removeLayer(layer);
            }, map);
            var latlngs = new Array();
            for (var j in data.data.area) {
                latlngs.push(L.latLng(data.data.area[j].x, (data.data.area[j].y)));
            }
            L.polygon(latlngs, {
                color: '#009933',
                opacity: 0.5,
                fill: true,
                fillColor: "#FFFF00",
                fillOpacity: 0.7
            }).bindPopup('<div class="map_farmLand">' +
                            '<table class="table table-bordered">' +
                            '<tr><td class="success">塘口号</td><td>' + data.data.farmLandID + '</td><td class="success">塘口位置</td><td>' + data.data.address + '</td></tr>' +
                            '<tr><td class="success">品种</td><td>' + data.data.product + '</td><td class="success">面积</td><td>' + data.data.farmArea + '</td></tr>' +
                            '<tr><td class="success">承包人</td><td>' + data.data.name + '</td><td class="success">身份证</td><td>' + data.data.IDCard + '</td></tr>' +
                            '</td><td>操作</td><td><button class="map_farmLand-back">返回</button></td></tr>' +
                            '</table>' +
                            '</div>', {
                                minWidth: 500,
                            })
                .on('click', function () {
                    $('.map_farmLand-back').click(function () {
                        map.setView(latlng, 11).
                        closePopup()
                    })
                })
                .addTo(map);

            map.fitBounds(latlngs);
        },
        error: function () {

        }
    })
}
